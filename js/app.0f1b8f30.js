(function(t){function e(e){for(var a,s,r=e[0],c=e[1],u=e[2],l=0,m=[];l<r.length;l++)s=r[l],i[s]&&m.push(i[s][0]),i[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);d&&d(e);while(m.length)m.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,r=1;r<n.length;r++){var c=n[r];0!==i[c]&&(a=!1)}a&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var a={},i={app:0},o=[];function s(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=a,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var u=0;u<r.length;u++)e(r[u]);var d=c;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"00cf":function(t,e,n){"use strict";var a=n("5fd5"),i=n.n(a);i.a},"0251":function(t,e,n){t.exports=n.p+"img/flag.bbeedfdb.svg"},"034f":function(t,e,n){"use strict";var a=n("64a9"),i=n.n(a);i.a},"149b":function(t,e,n){},2692:function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("header",[a("a",{attrs:{href:"#"},on:{click:t.showSplash}},[a("img",{attrs:{src:n("7294"),alt:"Waar ben ik?"}})])]),a("main",[a("Panorama",{staticClass:"panorama",attrs:{image:t.image}}),t.submittedPoint||t.showingSplash?t._e():a("div",{class:["inset",t.mapToggled?"toggled":""]},[a("div",{staticClass:"inset-toggle"},[a("Map",{attrs:{image:t.image,toggled:t.mapToggled},on:{click:t.handleMapClicked}}),a("div",{staticClass:"buttons"},[a("button",{staticClass:"skip-image",on:{click:function(e){return t.nextRound()}}},[t._v("Weet ik niet")]),a("button",{attrs:{"v:if":"",disabled:void 0===t.lastClickedPoint},on:{click:t.submit}},[t._v("Hier ben ik")])])],1),a("div",{staticClass:"buttons show-map"},[t.mapToggled?[a("button",{on:{click:t.toggle}},[t._v("Terug naar de foto")])]:[a("button",{on:{click:t.toggle}},[t._v("Laat kaart zien")])]],2)]),t.showEndResults?t._e():a("div",{staticClass:"game-status"},[a("div",{staticClass:"rounds"},[a("span",[t._v("Foto "+t._s(this.rounds.length+1)+"/"+t._s(this.nrOfRounds))])]),a("div",{staticClass:"points"},[a("span",[t._v(t._s(t.points)+" punten")])])])],1),t.showingSplash?[a("Splash",{on:{hide:t.hideSplash}})]:t.showEndResults?[a("EndResults",{attrs:{rounds:t.rounds},on:{close:t.newGame}})]:t.submittedPoint?[a("Results",{attrs:{image:t.image,submittedPoint:t.submittedPoint,buttonText:t.rounds.length===t.nrOfRounds-1?"Naar eindresultaat":"Volgende foto"},on:{close:t.nextRound}})]:t._e()],2)},o=[],s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal"},[a("div",{staticClass:"box"},[a("img",{attrs:{src:n("7294"),alt:"Waar ben ik?"}}),a("h2",[t._v("\n      Je wordt gedropt op een willekeurige plek in Amsterdam.\n      Kun je raden waar je bent? Hoe dichterbij, hoe hoger je score.\n    ")]),a("p",[t._v("\n      Gebruik je muis of je touchscreen om rond te kijken, net zoals met Google Street View.\n      Klik in de kaart als je weet waar de foto genomen is.\n    ")]),a("button",{on:{click:t.start}},[t._v("Start")]),t._m(0),t._m(1)])])},r=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("\n      Geïnspireerd door "),n("a",{attrs:{href:"https://geoguessr.com/world/play"}},[t._v("GeoGuessr")]),t._v(", maar dan voor\n      Amsterdam en gemaakt met open source-tools en Amsterdamse open data.\n      Lees meer over deze data op het "),n("a",{attrs:{href:"https://amsterdam.github.io/datablog/2019/03/21/360-gradenfotos-van-de-hele-stad/"}},[t._v("Datablog van\n      data.amsterdam.nl")]),t._v(".\n    ")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("\n      Gemaakt door "),n("a",{attrs:{href:"https://bertspaan.nl/"}},[t._v("Bert Spaan")]),t._v(", ontworpen door "),n("a",{attrs:{href:"http://luukvandeven.nl/"}},[t._v("Luuk van de Ven")]),t._v(". De broncode staat "),n("a",{attrs:{href:"https://github.com/bertspaan/waar-ben-ik"}},[t._v("op GitHub")]),t._v(".\n    ")])}],c={name:"Splash",methods:{start:function(){this.$emit("hide")}}},u=c,d=(n("d334"),n("2877")),l=Object(d["a"])(u,s,r,!1,null,"03370cac",null),m=l.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{ref:"marzipano",staticClass:"marzipano"})])},f=[],h=n("6579"),g=n.n(h),v={name:"Panorama",props:{image:Object},mounted:function(){var t=this.$refs.marzipano,e={stageType:null,stage:{preserveDrawingBuffer:!0,width:960}};this.viewer=new g.a.Viewer(t,e)},watch:{image:function(t){this.createScene(t)}},methods:{createScene:function(t){var e=g.a.ImageUrlSource.fromString(t.cubic_img_pattern,{cubeMapPreviewUrl:t._links.cubic_img_preview.href}),n={yaw:360*Math.random(),fov:90*Math.PI/180,pitch:0},a=g.a.RectilinearView.limit.traditional(12288,Math.PI/2),i=new g.a.RectilinearView(n,a),o=[{tileSize:256,size:256,fallbackOnly:!0},{tileSize:512,size:512},{tileSize:512,size:1024},{tileSize:512,size:2048}],s=this.viewer.createScene({source:e,geometry:new g.a.CubeGeometry(o),view:i,pinFirstLevel:!0});s.switchTo({transitionDuration:500})}}},b=v,_=(n("7b26"),Object(d["a"])(b,p,f,!1,null,"5cc2a801",null)),w=_.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"map",staticClass:"map"})},y=[],P=n("bd03"),C=n.n(P),S=n("0251"),j=n.n(S),T=[113,150],x=.25,O=[113,150],M=x;function z(t){var e=L.icon({iconUrl:C.a,popupAnchor:[0,-T[1]*x-5],iconSize:[T[0]*x,T[1]*x],iconAnchor:[T[0]*x/2,T[1]*x]});return L.marker(t,{icon:e})}function R(t){var e=L.icon({iconUrl:j.a,popupAnchor:[3,-O[1]*M-5],iconSize:[O[0]*M,O[1]*M],iconAnchor:[3,O[1]*M]});return L.marker(t,{icon:e})}var E=9,I=19;function $(t){var e=L.map(t,{minZoom:E,maxZoom:I,center:[52.37278,4.90034],zoom:11}),n="https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png";return L.tileLayer(n,{minZoom:E,maxZoom:I}).addTo(e),e}function D(t){return{type:"FeatureCollection",features:t.map(G).flat()}}function G(t){return[{type:"Feature",properties:{panoramaId:t.image.pano_id},geometry:t.image.geometry},{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[t.image.geometry.coordinates,t.submittedPoint.coordinates]}},{type:"Feature",properties:{type:"submission"},geometry:t.submittedPoint}]}function A(t){var e=t.coordinates;return"https://data.amsterdam.nl/data/geozoek/?modus=kaart&legenda=true&locatie=".concat(e[1],"%2C").concat(e[0])}function F(t,e){if("submission"===t.properties.type||t.properties.panoramaId){var n=A(t.geometry),a='<a href="'.concat(n,'" target="_blank">Bekijk deze locatie</a>');e.bindPopup(a)}}function B(t,e){var n=L.geoJSON(e,{onEachFeature:F,pointToLayer:function(t,e){return"submission"===t.properties.type?z(e):R(e)},style:function(){return{color:"black",weight:4,opacity:.7,dashArray:"0,10",lineJoin:"round"}}}).addTo(t);return t.fitBounds(n.getBounds(),{padding:[25,25]}),n}var J=[5e3,1e3,500,100,25],N=J[0],V=1e3,U=10;function Z(t){var e=Math.max(N-t,0)/N;return Math.round(Math.pow(e,2)*(V/U))*U}function H(t){return t<1e3?"".concat(t," meter"):"".concat(t<1e4?Math.round(t/10)/100:Math.round(t/100)/10," km")}var W={name:"Map",props:{image:Object,toggled:Boolean},mounted:function(){var t=this,e=$(this.$refs.map),n=L.geoJSON(null,{pointToLayer:function(t,e){return z(e)}}).addTo(e);e.on("click",function(e){var n={type:"Point",coordinates:[e.latlng.lng,e.latlng.lat]};t.mapClick(n)}),this.guessLayer=n,this.map=e},watch:{image:function(){this.guessLayer.clearLayers()},toggled:function(){var t=this;this.toggled&&window.setTimeout(function(){t.map.invalidateSize()},150)}},methods:{mapClick:function(t){this.$emit("click",t),this.guessLayer.clearLayers(),this.guessLayer.addData(t)}}},K=W,q=(n("bc8f"),Object(d["a"])(K,k,y,!1,null,"48f21556",null)),Q=q.exports,X=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"modal"},[n("div",{staticClass:"box"},[n("div",{staticClass:"score"},[n("div",{staticClass:"text"},[n("span",{staticClass:"distance"},[t._v(t._s(t.displayDistance))]),t._v(": "+t._s(t.points)+" punten\n      ")]),n("div",[n("stars",{attrs:{distanceToImage:t.distanceToImage}})],1)]),n("div",{ref:"map",staticClass:"map"}),n("button",{on:{click:t.closeClick}},[t._v(t._s(t.buttonText))])])])},Y=[],tt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ol",{staticClass:"stars"},t._l(t.points,function(e){return a("li",{key:e},[t.distanceToImage<=e?[a("img",{attrs:{src:n("b150")}})]:[a("img",{attrs:{src:n("9656")}})]],2)}),0)},et=[],nt=(n("c5f6"),{data:function(){return{points:J}},props:{distanceToImage:Number}}),at=nt,it=(n("00cf"),Object(d["a"])(at,tt,et,!1,null,"565d6efa",null)),ot=it.exports,st=n("8f76"),rt=n.n(st),ct={components:{Stars:ot},name:"Results",props:{buttonText:String,image:Object,submittedPoint:Object},mounted:function(){var t=$(this.$refs.map),e=D([{image:this.image,submittedPoint:this.submittedPoint}]);this.resultsLayer=B(t,e),this.map=t},methods:{closeClick:function(){this.$emit("close",this.distanceToImage)}},computed:{distanceToImage:function(){return Math.round(rt()(this.image.geometry,this.submittedPoint,{units:"meters"}))},points:function(){return Z(this.distanceToImage)},displayDistance:function(){return H(this.distanceToImage)}}},ut=ct,dt=(n("f764"),Object(d["a"])(ut,X,Y,!1,null,"f5b024a4",null)),lt=dt.exports,mt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"modal"},[n("div",{staticClass:"box"},[n("div",{staticClass:"score"},[n("div",{staticClass:"points"},[t._v("\n        Totaal: "+t._s(t.points)+" punten\n      ")]),n("div",[n("stars",{attrs:{distanceToImage:t.avgDistance}})],1)]),n("div",{ref:"map",staticClass:"map"}),n("div",{staticClass:"explain"},[n("p",[t._v("\n        In "+t._s(t.rounds.length)+" rondes zat je er totaal "+t._s(t._f("formatDistance")(t.sumDistance))+" naast, dat is gemiddeld "+t._s(t._f("formatDistance")(t.avgDistance))+" per ronde.\n      ")])]),n("button",{on:{click:t.closeClick}},[t._v("Nieuw spel")])])])},pt=[],ft=n("2ef0"),ht={name:"EndResults",components:{Stars:ot},props:{rounds:Array},mounted:function(){var t=$(this.$refs.map),e=this.rounds.filter(function(t){return null!==t.distance}),n=D(e);this.resultsLayer=B(t,n),this.map=t},computed:{avgDistance:function(){return Object(ft["mean"])(this.rounds.map(function(t){return t.distance}))},sumDistance:function(){return Object(ft["sum"])(this.rounds.map(function(t){return t.distance}))},points:function(){return Object(ft["sum"])(this.rounds.map(function(t){return t.distance?Z(t.distance):0}))}},methods:{closeClick:function(){this.$emit("close")}},filters:{formatDistance:H}},gt=ht,vt=(n("9ffc"),Object(d["a"])(gt,mt,pt,!1,null,"651fbd07",null)),bt=vt.exports,_t=n("bc3a"),wt=n.n(_t);function kt(t){return wt.a.get(t).then(function(t){return t.data})}function yt(t,e){return wt.a.post(t,e).then(function(t){return t.data})}var Pt=n("768b"),Ct="https://api.data.amsterdam.nl/panorama";function St(t,e){var n=Object(Pt["a"])(t.coordinates,2),a=n[0],i=n[1];return"".concat(Ct,"/panoramas/?near=").concat(a,",").concat(i,"&srid=4326&radius=").concat(e,"&page_size=1")}function jt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;return kt(St(t,e)).then(function(n){try{var a=n._embedded.panoramas[0];return a}catch(i){throw new Error("No panorama found within ".concat(e," meter of ").concat(t.coordinates,"!"))}})}var Tt=n("3b74"),xt=n.n(Tt);function Ot(t){var e=t.features.map(function(t){return xt()(t,{units:"meters"})}),n=e.reduce(function(t,e){return t+e},0);function a(t,e){return[t[0]*e,t[1]*e]}function i(t,e){return[t[0]+e[0],t[1]+e[1]]}return function(){var o=Math.random()*Math.ceil(n),s=0,r=0;while(s<o)s+=e[r],r+=1;var c=t.features[r-1],u=Math.random(),d=Math.sqrt(Math.random()),l=c.geometry.coordinates[0][0],m=c.geometry.coordinates[0][1],p=c.geometry.coordinates[0][2],f=i(a(l,1-d),a(i(a(m,1-u),a(p,u)),d));return{type:"Point",coordinates:f}}}var Lt=!1,Mt={name:"app",components:{Splash:m,Panorama:w,Map:Q,Results:lt,EndResults:bt},data:function(){return{showingSplash:!0,showEndResults:!1,mapToggled:!1,image:void 0,submittedPoint:void 0,error:void 0,randomPoint:void 0,lastClickedPoint:void 0,nrOfRounds:5,rounds:[]}},mounted:function(){var t=this;kt("area-triangulation.geojson").then(function(e){t.randomPoint=Ot(e)}).then(this.newImage)},computed:{points:function(){return Object(ft["sum"])(this.rounds.map(function(t){return t.distance?Z(t.distance):0}))}},methods:{nextRound:function(t){this.rounds.push({distance:t||null,submittedPoint:this.submittedPoint,image:this.image}),this.lastClickedPoint=void 0,this.submittedPoint=void 0,this.rounds.length===this.nrOfRounds?(this.mapToggled=!1,this.showEndResults=!0):this.newImage()},newImage:function(){var t=this;this.mapToggled=!1,this.showEndResults=!1,this.randomPoint&&jt(this.randomPoint()).then(function(e){t.lastClickedPoint=void 0,t.submittedPoint=void 0,t.image=e})},newGame:function(){this.rounds=[],this.mapToggled=!1,this.showEndResults=!1,this.lastClickedPoint=void 0,this.submittedPoint=void 0,this.newImage()},toggle:function(){this.mapToggled=!this.mapToggled},submit:function(){if(this.image&&this.lastClickedPoint){var t={panoramaId:this.image.pano_id,pointSubmission:this.lastClickedPoint,pointLocation:{type:"Point",coordinates:this.image.geometry.coordinates.slice(0,2)}};Lt||yt("https://waar-ben-ik.glitch.me/submissions",t).catch(function(){}),this.submittedPoint=this.lastClickedPoint}},showSplash:function(){this.showingSplash=!0},hideSplash:function(){this.showingSplash=!1},handleMapClicked:function(t){this.lastClickedPoint=t}}},zt=Mt,Rt=(n("034f"),Object(d["a"])(zt,i,o,!1,null,null,null)),Et=Rt.exports;a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(Et)}}).$mount("#app")},"5fd5":function(t,e,n){},"64a9":function(t,e,n){},7294:function(t,e,n){t.exports=n.p+"img/waar-ben-ik.a9ef36e0.svg"},"7b26":function(t,e,n){"use strict";var a=n("149b"),i=n.n(a);i.a},9656:function(t,e,n){t.exports=n.p+"img/star-transparent.b273821b.svg"},"9ffc":function(t,e,n){"use strict";var a=n("fdba"),i=n.n(a);i.a},b150:function(t,e,n){t.exports=n.p+"img/star-white.a37d3194.svg"},bc8f:function(t,e,n){"use strict";var a=n("e805"),i=n.n(a);i.a},bcfd:function(t,e,n){},bd03:function(t,e,n){t.exports=n.p+"img/marker.893459da.svg"},d334:function(t,e,n){"use strict";var a=n("bcfd"),i=n.n(a);i.a},e805:function(t,e,n){},f764:function(t,e,n){"use strict";var a=n("2692"),i=n.n(a);i.a},fdba:function(t,e,n){}});
//# sourceMappingURL=app.0f1b8f30.js.map